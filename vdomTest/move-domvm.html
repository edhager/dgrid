<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<title>Moved Item Test</title>
	<meta name='viewport' content='width=570'>
	<style>
		@import '../../dojo/resources/dojo.css';

		input {
			width: 5em;
		}

		#test {
			border: 1px solid #999;
			margin-top: 1em;
			overflow: auto;
			width: 30em;
		}

		.item .cell {
			display: inline-block;
			width: 50px;
			margin-right: 5px;
		}

		.item .cell.name {
			width: 100px;
		}
	</style>
</head>
<body>

<h2>Testing modifications</h2>

<h3>Modify in-place</h3>
<div>
	<button id='modify1' type='button'>Modify 1st item first name</button>
	<button id='modify2' type='button'>Modify 1st item second name</button>
</div>

<h3>Add</h3>
<div>
	<button id='add-first' type='button'>Add first item</button>
	<button id='add-last' type='button'>Add last item</button>
</div>

<h3>Remove</h3>
<div>
	<button id='remove-first' type='button'>Remove first item</button>
	<button id='remove-last' type='button'>Remove last item</button>
</div>

<h3>Move</h3>
<div>
	<button id='move-first-to-last' type='button'>Move first item to end</button>
	<button id='move-last-to-first' type='button'>Move last item to top</button>
</div>
<form id='move'>
<div>
	<label>From index: <input name='from'></label>
	<label>to (before) index: <input name='to'></label>
	<button>Move</button>
</div>
<div>(From may be a range in 'start-end' format, where end is inclusive)</div>
</form>

<div id='test'></div>

<!-- npm install domvm-->
<script src='../node_modules/domvm/dist/domvm.min.js'></script>
<script src='../../dojo/dojo.js' data-dojo-config='async: true'></script>
<script>
	require({
		packages: [
			{name: 'maquette', location: '../dgrid/node_modules/maquette/dist', main: 'maquette'}
		]
	}, [
		'maquette',
		'dojo/Deferred',
		'dojo/on',
		'dgrid/vdom/hyperscript'
	], function (maquette, Deferred, on, h) {
		var projector = maquette.createProjector();

		var data = [];
		var lastIndex = 0;

		function createItem() {
			return {
				id: ++lastIndex,
				modFirst: 0,
				modLast: 0,
				first: 'First ' + lastIndex,
				last: 'Last ' + lastIndex
			};
		}

		while (lastIndex < 10) {
			data.push(createItem());
		}

		function listView(vm, data) {
			return function () {
				return ['div', data.map(function (item) {
					return ['div.item', [
							['div.cell', item.id],
							['div.cell.name', item.first + (item.modFirst ? '(edit ' + item.modFirst + ')' : '')],
							['div.cell.name', item.last + (item.modLast ? '(edit ' + item.modLast + ')' : '')]
					]];
				})];
			}
		}

		var vm = domvm.view(listView, data);

		vm.mount(document.getElementById('test'));

		on(document.getElementById('modify1'), 'click', function () {
			data[0].modFirst++;
			vm.redraw();
		});

		on(document.getElementById('modify2'), 'click', function () {
			data[0].modLast++;
			vm.redraw();
		});

		on(document.getElementById('add-first'), 'click', function () {
			data.unshift(createItem());
			vm.redraw();
		});

		on(document.getElementById('add-last'), 'click', function () {
			data.push(createItem());
			vm.redraw();
		});

		on(document.getElementById('remove-first'), 'click', function () {
			data.shift();
			projector.scheduleRender();
		});

		on(document.getElementById('remove-last'), 'click', function () {
			data.pop();
			vm.redraw();
		});

		on(document.getElementById('move-first-to-last'), 'click', function () {
			data.push(data.shift());
			vm.redraw();
		});

		on(document.getElementById('move-last-to-first'), 'click', function () {
			data.unshift(data.pop());
			vm.redraw();
		});

		on(document.getElementById('move'), 'submit', function (event) {
			event.preventDefault();
			var fromParts = this.elements.from.value.split('-');
			var count = fromParts.length === 2 ? fromParts[1] - fromParts[0] + 1 : 1;
			var fromIndex = fromParts[0];
			var toIndex = this.elements.to.value;

			var items = data.splice(fromIndex, count);
			data.splice.apply(data, [toIndex, 0].concat(items));
			vm.redraw();
		});
	});
</script>
</body>
</html>
